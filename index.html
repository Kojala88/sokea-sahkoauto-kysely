<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sokea s√§hk√∂auto-kysely ‚Äì Koneistus Ojala</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b0f14; color: #e8eef7; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    .card { background: #111826; border: 1px solid #223047; border-radius: 18px; padding: 18px; box-shadow: 0 8px 30px rgba(0,0,0,.25); overflow: hidden; }
    h1 { font-size: 22px; margin: 0 0 6px; }
    h2 { margin: 0; font-size: 18px; }
    p { margin: 8px 0; color: #b7c6dd; line-height: 1.45; }
    .muted { color: #9bb0cc; font-size: 13px; }

    .progress { height: 10px; background: #0f1725; border: 1px solid #223047; border-radius: 999px; overflow: hidden; margin: 14px 0 18px; }
    .bar { height: 100%; width: 0%; background: #4f8cff; transition: width .25s ease; }

    .q { font-size: 18px; margin: 0 0 10px; }
    .opts { display: grid; gap: 10px; margin-top: 10px; }
    button.opt {
      text-align: left; padding: 12px 12px; border-radius: 14px;
      border: 1px solid #2a3b57; background: #0f1725; color: #e8eef7;
      cursor: pointer; transition: transform .03s ease, border-color .15s ease, background .15s ease;
    }
    button.opt:hover { border-color: #4f8cff; }
    button.opt.selected { border-color: #4f8cff; background: #0c1524; }
    button.opt:active { transform: scale(0.99); }

    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    .btn { padding: 10px 12px; border-radius: 12px; border: 1px solid #2a3b57; background: #0f1725; color: #e8eef7; cursor: pointer; }
    .btn.primary { background: #4f8cff; border-color: #4f8cff; color: #0b0f14; font-weight: 650; }
    .btn:disabled { opacity: .5; cursor: not-allowed; }

    .tag { display:inline-block; padding: 4px 8px; border: 1px solid #2a3b57; border-radius: 999px; font-size: 12px; color:#b7c6dd; margin: 4px 6px 0 0; }
    .pill { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: #111826; border: 1px solid #223047; color: #b7c6dd; }
    .small { font-size: 13px; color: #b7c6dd; }

    .footer { margin-top: 14px; display:flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; }

    .grid { display:grid; gap:12px; grid-template-columns: repeat(3, minmax(0, 1fr)); margin-top: 12px; }
    @media (max-width: 920px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 560px){ .grid{ grid-template-columns: 1fr; } }

    .car { border: 1px solid #223047; background:#0f1725; border-radius: 16px; overflow:hidden; }
    .carTop { display:flex; gap:10px; padding: 12px; align-items:center; }
    .thumb {
      width: 66px; height: 48px; border-radius: 12px;
      border: 1px solid #223047;
      background: radial-gradient(circle at 30% 30%, #1b2a44, #0b0f14);
      display:flex; align-items:center; justify-content:center;
      flex: 0 0 auto;
    }
    .thumb svg { width: 48px; height: 32px; opacity: .9; }
    .carName { font-weight: 700; color:#e8eef7; }
    .carMeta { font-size: 12px; color:#9bb0cc; margin-top: 2px; }

    details { border:1px solid #223047; background:#0f1725; border-radius: 14px; padding: 12px; margin-top: 12px; }
    summary { cursor:pointer; font-weight: 650; color:#e8eef7; }

    a { color: #84b3ff; }
    code { background: #0f1725; border: 1px solid #223047; padding: 2px 6px; border-radius: 8px; }

    .notice { border:1px dashed #2a3b57; border-radius: 14px; padding: 10px 12px; margin-top: 10px; color:#b7c6dd; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">

      <!-- OPTION C header -->
      <div style="display:flex; justify-content:center; padding:18px; margin:-18px -18px 16px -18px; border-bottom:1px solid #223047; background:linear-gradient(180deg,#0f1725,#0b0f14);">
        <a href="https://www.koneistusojala.fi" target="_blank" rel="noopener" aria-label="Koneistus Ojala">
          <img src="logo-koneistus-ojala.png" alt="Koneistus Ojala" style="max-height:110px; max-width:520px; width:auto; height:auto; display:block;" />
        </a>
      </div>

      <h1>üîí Sokea s√§hk√∂auto-kysely</h1>
      <p>Vastaa ominaisuuksiin ja tarpeisiin. <b>Merkki ja malli paljastuu vasta lopussa.</b></p>
      <p class="muted">Huom: Varusteet (koukku, matrix, avustimet) vaihtelevat varustelun/markkinan mukaan ‚Äî t√§ss√§ ne ovat mieltymyksi√§, eiv√§t ‚Äúkovia totuuksia‚Äù.</p>

      <div class="progress" aria-label="Edistyminen"><div class="bar" id="bar"></div></div>
      <div id="screen"></div>

      <div class="footer">
        <button class="btn" id="backBtn">‚Üê Takaisin</button>
        <button class="btn" id="restartBtn">Aloita alusta</button>
      </div>

    </div>
  </div>

<script>
  function carSvg(kind){
    const body = (kind==="sedan")
      ? "M6 18h5l5-6h16l6 6h4"
      : (kind==="hatch")
        ? "M6 18h6l4-6h14l7 6h5"
        : "M5 18h7l4-6h18l6 6h5";
    return `
      <svg viewBox="0 0 64 36" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="${body}" stroke="#B7C6DD" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M9 18v6h46v-6" stroke="#B7C6DD" stroke-width="2.5" stroke-linecap="round"/>
        <circle cx="18" cy="26" r="4" stroke="#B7C6DD" stroke-width="2.5"/>
        <circle cx="46" cy="26" r="4" stroke="#B7C6DD" stroke-width="2.5"/>
        <path d="M24 12h10" stroke="#B7C6DD" stroke-width="2.5" stroke-linecap="round"/>
      </svg>`;
  }

  // Autos (CLA Electric added)
  const cars = [
    { code:"Project Redwood", name:"Tesla Model Y", kind:"suv", tags:new Set(["crossover","family","range_ok","fast_charge","good_infra","tech","tow_capable","popular","known_brand","price_mid"]), notes:"Suosittu kokonaispaketti. Hyv√§ arki + reissut. Trimmi (RWD/AWD) ehdotetaan lopussa." },
    { code:"Project Aurora", name:"Tesla Model 3", kind:"sedan", tags:new Set(["sedan","efficient","range_ok","fast_charge","good_infra","tech","popular","known_brand","price_mid"]), notes:"Tehokas ja tekninen sedan. Hyv√§ reissuun ja arkeen." },

    { code:"Project Silverline", name:"Mercedes-Benz CLA Electric", kind:"sedan", tags:new Set(["sedan","premium","tech","highway","range_ok","known_brand","price_premium"]), notes:"Premium-sedan painotus: br√§ndi, mukavuus/tekniikka ja moottoritieajon fiilis." },

    { code:"Project Cedar", name:"Volkswagen ID.4", kind:"suv", tags:new Set(["crossover","family","comfort","practical","tow_capable","popular","known_brand","price_mid"]), notes:"Perhe-crossover: mukavuus ja k√§yt√§nn√∂llisyys." },
    { code:"Project Atlas", name:"Volkswagen ID.7", kind:"sedan", tags:new Set(["sedan","comfort","range_ok","practical","highway","known_brand","price_premium"]), notes:"Pitk√§n matkan fiilis: tilaa ja mukavuutta, sopii moottoritielle." },
    { code:"Project Pine", name:"Volkswagen ID.3", kind:"hatch", tags:new Set(["hatchback","city","compact","practical","popular","known_brand","price_mid"]), notes:"Kompakti arkeen/kaupunkiin." },
    { code:"Project Saffron", name:"Kia EV3", kind:"suv", tags:new Set(["crossover_small","city","practical","tech","value","known_brand","price_mid"]), notes:"Pienempi crossover: arki + moderni fiilis, usein hyv√§ hinta/ominaisuudet." },
    { code:"Project Ruby", name:"Renault 5 E-Tech Electric", kind:"hatch", tags:new Set(["city","compact","hatchback","fun","value","known_brand","price_mid"]), notes:"Kaupunkikokoluokka ja persoonallinen hatchback-idea." },
    { code:"Project Birch", name:"≈†koda Enyaq", kind:"suv", tags:new Set(["crossover","family","spacey","comfort","tow_capable","known_brand","price_mid"]), notes:"Isohko ja tilava. Perhe + tavara + mukavuus." },
    { code:"Project Nimbus", name:"Volvo EX30", kind:"suv", tags:new Set(["crossover_small","city","tech","safety","known_brand","popular","price_mid"]), notes:"Pieni ja moderni: kaupunki + turvallisuus/tekniikka." },
    { code:"Project Slate", name:"BMW i4", kind:"sedan", tags:new Set(["sedan","premium","fun","highway","range_ok","known_brand","price_premium"]), notes:"Ajamisen fiilis + premium-sedan." },
    { code:"Project Citron", name:"Citro√´n e-C3", kind:"hatch", tags:new Set(["city","budget","compact","simple","value","known_brand","price_budget"]), notes:"Budjetti + kaupunki. Simppeli ja j√§rkev√§ perusratkaisu." },
    { code:"Project Pebble", name:"Dacia Spring", kind:"hatch", tags:new Set(["city","budget","simple","compact","value","known_brand","price_budget"]), notes:"Minimi-budjetti ja kaupunki. Ei reissupainotteiseen k√§ytt√∂√∂n." },
  ];

  // QUESTIONS ‚Äî budjetti- ja joustokysymykset ovat mukana (#4 ja #5)
  const questions = [
    { q:"P√§√§asiallinen k√§ytt√∂?", opts:[
      { t:"Kaupunki/lyhyet matkat", add:{ city:4, compact:2, budget:1, easy:1 } },
      { t:"Sekalaista arkea + satunnaiset reissut", add:{ practical:3, comfort:2, range_ok:1 } },
      { t:"Paljon pitki√§ matkoja", add:{ highway:3, range_ok:3, fast_charge:3, good_infra:2 } },
    ]},
    { q:"Tila ja korimalli?", opts:[
      { t:"Kompakti (helpompi parkki/ketteryys)", add:{ compact:4, city:2, crossover_small:1, hatchback:1 } },
      { t:"Normaali koko", add:{ practical:2, comfort:1 } },
      { t:"Perhe + paljon tavaraa", add:{ family:5, spacey:5, tow_capable:1 } },
    ]},
    { q:"Mik√§ on sinulle t√§rkein fiilis?", opts:[
      { t:"Mahdollisimman edullinen & helppo", add:{ budget:5, simple:2, value:2 } },
      { t:"Paras hinta/laatu", add:{ value:4, practical:2, efficient:1 } },
      { t:"Premium/mukavuus", add:{ premium:4, comfort:3, tech:1 } },
      { t:"Sporttinen ajotuntuma", add:{ fun:5, tech:1 } },
    ]},

    // <-- N√ÑM√Ñ KAKSI OVAT NE BUDJETTIKYSYMYKSET
    { q:"Paljonko auton ostohinta saa olla maksimissaan?", opts:[
      { t:"Alle 30 000 ‚Ç¨", add:{ price_budget: 8, price_mid: 1, price_premium: -10 } },
      { t:"30 000 ‚Äì 40 000 ‚Ç¨", add:{ price_budget: 5, price_mid: 4, price_premium: -8 } },
      { t:"40 000 ‚Äì 55 000 ‚Ç¨", add:{ price_budget: 2, price_mid: 7, price_premium: -4 } },
      { t:"55 000 ‚Äì 70 000 ‚Ç¨", add:{ price_mid: 5, price_premium: 4 } },
      { t:"Yli 70 000 ‚Ç¨", add:{ price_premium: 8 } },
    ]},
    { q:"Kuinka paljon olisit valmis joustamaan budjetissa, jotta saat haluamasi varusteet?", opts:[
      { t:"En jousta k√§yt√§nn√∂ss√§ lainkaan", add:{ budget_strict: 4, price_premium: -2 } },
      { t:"Voin joustaa v√§h√§n (noin 5%)", add:{ budget_flex: 2 } },
      { t:"Voin joustaa selv√§sti (noin 10‚Äì15%)", add:{ budget_flex: 4, price_premium: 2 } },
      { t:"Voin joustaa paljon (noin 20%+)", add:{ budget_flex: 6, price_premium: 4 } },
    ]},

    { q:"Latausreissuissa t√§rkeint√§?", opts:[
      { t:"En juuri reissaa ‚Üí perus riitt√§√§", add:{ city:1, simple:1 } },
      { t:"Haluan nopean pikalatauksen", add:{ fast_charge:5 } },
      { t:"Haluan maksimaalisen helppouden (verkosto/softa)", add:{ good_infra:5, tech:2, easy:2 } },
    ]},
    { q:"Kulutus/tehokkuus (km/kWh) ‚Äì kuinka t√§rke√§√§?", opts:[
      { t:"Ei juuri v√§li√§", add:{ comfort:1 } },
      { t:"T√§rke√§", add:{ efficient:3, value:1 } },
      { t:"Eritt√§in t√§rke√§", add:{ efficient:5, value:2 } },
    ]},
    { q:"Turvallisuus ‚Äì kuinka paljon painotat?", opts:[
      { t:"Perus riitt√§√§", add:{} },
      { t:"T√§rke√§", add:{ safety:3, tech:1 } },
      { t:"Eritt√§in t√§rke√§", add:{ safety:5, premium:1 } },
    ]},
    { q:"Voimansiirto?", opts:[
      { t:"Takaveto k√§y", add:{ pref_rwd:3 } },
      { t:"Neliveto on t√§rke√§", add:{ pref_awd:4, snow:2 } },
      { t:"Ei v√§li√§", add:{ practical:1 } },
    ]},
  ];

  const state = { i: 0, answers: Array(questions.length).fill(null), scores: {}, view: "home" };

  function addScores(add) { for (const [k,v] of Object.entries(add)) state.scores[k] = (state.scores[k] || 0) + v; }
  function recomputeScores() {
    state.scores = {};
    for (let qi=0; qi<questions.length; qi++){
      const ai = state.answers[qi];
      if (ai === null) continue;
      addScores(questions[qi].opts[ai].add);
    }
  }
  function carScore(car) {
    let total = 0;
    for (const [k,v] of Object.entries(state.scores)) if (car.tags.has(k)) total += v;
    return total;
  }

  function trimHint(model) {
    const prefAwd = (state.scores.pref_awd || 0) >= 4;
    const sporty  = (state.scores.fun || 0) >= 5;
    const highway = (state.scores.highway || 0) >= 3;
    if (model === "Tesla Model Y" || model === "Tesla Model 3") {
      if (prefAwd) return sporty ? "Trimmi-idea: Performance tai Long Range AWD." : "Trimmi-idea: Long Range AWD.";
      return highway ? "Trimmi-idea: Long Range (reissu) tai RWD jos hinta t√§rkein." : "Trimmi-idea: RWD (hinta/tehokkuus).";
    }
    return "";
  }

  function gotoHome(){ state.view="home"; render(); }
  function startQuiz(){ state.view="quiz"; state.i=0; render(); }
  function reset(){ state.view="home"; state.i=0; state.answers=Array(questions.length).fill(null); state.scores={}; render(); }
  function gotoResults(){ state.view="results"; render(); }

  function renderHome(screen){
    const carCards = cars.map(c => `
      <div class="car">
        <div class="carTop">
          <div class="thumb">${carSvg(c.kind)}</div>
          <div>
            <div class="carName">${c.name}</div>
            <div class="carMeta">Mukana testiss√§ ‚Ä¢ piilonimi: <span class="pill">${c.code}</span></div>
          </div>
        </div>
      </div>
    `).join("");

    screen.innerHTML = `
      <h2>Valitse ensin</h2>
      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="startBtn">Aloita kysely ‚Üí</button>
        <button class="btn" id="listBtn">N√§yt√§ mukana olevat autot</button>
      </div>

      <div class="notice">
        <b>Vinkki:</b> Kysymyslistassa on nyt mukana my√∂s <b>maksimihinta</b> ja <b>budjettijousto</b>.
      </div>

      <details id="carsDetails">
        <summary>Autot mukana (${cars.length} kpl)</summary>
        <p class="muted">T√§ss√§ n√§kyy kaikki autot, jotka ovat mukana pisteytyksess√§. Kyselyn aikana nimi√§ ei n√§ytet√§.</p>
        <div class="grid">${carCards}</div>
      </details>
    `;

    document.getElementById("startBtn").onclick = startQuiz;
    document.getElementById("listBtn").onclick = () => {
      const d = document.getElementById("carsDetails");
      d.open = true;
      d.scrollIntoView({ behavior: "smooth", block: "start" });
    };
  }

  function renderQuiz(screen, bar){
    const backBtn = document.getElementById("backBtn");
    const restartBtn = document.getElementById("restartBtn");

    const progress = Math.round((state.i / questions.length) * 100);
    bar.style.width = `${progress}%`;

    backBtn.disabled = state.i === 0;
    backBtn.onclick = () => { if (state.i > 0) { state.i--; render(); } };
    restartBtn.onclick = reset;

    if (state.i >= questions.length) { gotoResults(); return; }

    const q = questions[state.i];
    const chosen = state.answers[state.i];

    screen.innerHTML = `
      <p class="muted">Kysymys ${state.i + 1} / ${questions.length}</p>
      <div class="q">${q.q}</div>
      <div class="opts" id="opts"></div>
      <div class="row">
        <button class="btn primary" id="nextBtn" ${chosen === null ? "disabled" : ""}>Seuraava ‚Üí</button>
      </div>
    `;

    const optsDiv = document.getElementById("opts");
    q.opts.forEach((o, idx) => {
      const btn = document.createElement("button");
      btn.className = "opt" + (chosen === idx ? " selected" : "");
      btn.textContent = o.t;
      btn.onclick = () => { state.answers[state.i] = idx; render(); };
      optsDiv.appendChild(btn);
    });

    document.getElementById("nextBtn").onclick = () => {
      if (state.answers[state.i] === null) return;
      state.i++;
      render();
    };
  }

  function renderResults(screen, bar){
    recomputeScores();
    bar.style.width = `100%`;

    const ranked = cars
      .map(c => ({ car: c, pts: carScore(c) }))
      .sort((a,b) => b.pts - a.pts);

    const top = ranked.slice(0, 5);
    const usedTags = Object.keys(state.scores).filter(k => (state.scores[k] || 0) > 0);

    screen.innerHTML = `
      <p class="muted">Edistyminen: 100%</p>
      <h2 style="margin:0 0 8px;">‚úÖ Valmis! Nyt paljastetaan suositus</h2>

      <div class="grid" style="grid-template-columns: 1fr; gap: 12px; margin-top: 12px;">
        ${top.map((x, idx) => {
          const matched = usedTags.filter(t => x.car.tags.has(t));
          const tagsHtml = matched.slice(0, 14).map(t => `<span class="tag">${t}</span>`).join("");
          const hint = trimHint(x.car.name);
          return `
            <div class="car">
              <div class="carTop">
                <div class="thumb">${carSvg(x.car.kind)}</div>
                <div style="flex:1;">
                  <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
                    <div class="carName">#${idx+1}: ${x.car.name}</div>
                    <span class="pill">pisteet: ${x.pts}</span>
                  </div>
                  <div class="small" style="margin-top:6px;">Miksi: ${x.car.notes}</div>
                  ${hint ? `<div class="small" style="margin-top:6px;"><b>${hint}</b></div>` : ``}
                  ${matched.length ? `<div style="margin-top:8px;">${tagsHtml}</div>` : ``}
                </div>
              </div>
            </div>
          `;
        }).join("")}
      </div>

      <details>
        <summary>N√§yt√§ painotukset (debug)</summary>
        <div style="margin-top:8px;">
          ${Object.entries(state.scores).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<span class="tag">${k}: ${v}</span>`).join("")}
        </div>
      </details>
    `;

    document.getElementById("backBtn").disabled = true;
    document.getElementById("restartBtn").onclick = reset;
  }

  function render(){
    const screen = document.getElementById("screen");
    const bar = document.getElementById("bar");

    if (state.view === "home") {
      bar.style.width = "0%";
      document.getElementById("backBtn").disabled = true;
      document.getElementById("restartBtn").onclick = reset;
      renderHome(screen);
      return;
    }
    if (state.view === "quiz") { renderQuiz(screen, bar); return; }
    if (state.view === "results") { renderResults(screen, bar); return; }
  }

  render();
</script>
</body>
</html>
